!function(){const t="ld_visits",e="ld_start_time",s="ld_end_time",n="ld_inactive_start_time",o="ld_total_inactive_time",a={PEOPLE_DATA_LABS:"peopledatalabs",CLEARBIT:"clearbit","6_SENSE":"6sense"};async function r(t,e){try{const s=await async function(){try{const t=await fetch("https://api64.ipify.org?format=json");return(await t.json()).ip}catch(t){return null}}(),n=document.getElementById("letterdrop-analytics"),o=n?.getAttribute("src"),r=new URL(o),i=r.searchParams.get("p"),c=r.searchParams.get("api"),l=r.searchParams.get("platform"),m=r.searchParams.get("customerId");let g=null;c&&l===a["6_SENSE"]&&(g=await async function(t,e,s){try{if(!s)return null;let n=localStorage.getItem(String(btoa(s)));if(n)try{if(n=JSON.parse(n),n?.company)return n}catch(t){}let o={Authorization:`Token ${atob(t)}`};e&&(o["X-6s-CustomID"]=atob(e));const a=await fetch("https://epsilon.6sense.com/v3/company/details",{method:"GET",mode:"cors",cache:"no-cache",headers:o,redirect:"follow",referrerPolicy:"no-referrer"});return n=await a.json()||null,n?.company&&localStorage.setItem(String(btoa(s)),JSON.stringify(n)),n}catch(t){return console.log("Letterdrop tracking error:",t),null}}(c,m,s)),function(t,e,s,n,o,a){fetch("https://us-central1-zmtvapp.cloudfunctions.net/letterdrop-tracking",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({pageUrl:t,ipAddress:e,publicationId:s,sessionDuration:n,platform:a,companyDetails:o||""})}).then((t=>{t.ok||console.error("Failed to send tracking data:",t.status,t.statusText)})).catch((t=>{console.error("Error sending tracking data:",t)}))}(t,s,i,e,g,l)}catch(t){}}function i(){try{switch(document.visibilityState){case"hidden":sessionStorage.setItem(n,new Date);break;case"visible":let t=sessionStorage.getItem(n);if(t){let e=new Date-new Date(t),s=parseInt(sessionStorage.getItem(o));s&&!isNaN(s)&&(e+=s),sessionStorage.setItem(o,e)}sessionStorage.setItem(n,"")}}catch(t){}}!function(){try{let a=document.location.href.replace(document.location.hash,""),i=sessionStorage.getItem(t);if(!i||i===a)return;let c=sessionStorage.getItem(e),l=sessionStorage.getItem(s);if(!l||!c)return;let m=new Date(l)-new Date(c);m-=sessionStorage.getItem(o),m=Math.ceil(m/1e3),r(i,m),sessionStorage.setItem(t,""),sessionStorage.setItem(e,""),sessionStorage.setItem(s,""),sessionStorage.getItem(n,""),sessionStorage.setItem(o,"")}catch(t){}}(),function(){sessionStorage.setItem(t,document.location.href.replace(document.location.hash,""));let n=sessionStorage.getItem(e);n||(n=new Date),sessionStorage.setItem(e,n),document.addEventListener("visibilitychange",i),window.addEventListener("beforeunload",(function(t){sessionStorage.setItem(s,new Date),document.removeEventListener("visibilitychange",i)}))}()}();
